<!doctype html>
<html>
<head>
  <title>Wines | GD 2013 Contest</title>

  <script type="text/javascript" src="http://visjs.org/vis.js"></script>
  <script type="text/javascript" src="data.js"></script>

  <style type="text/css">
    html, body, select {
      font-family: "DejaVu Sans", verdana, arial, sans-serif;
      font-size: 11pt;
    }

    .item.box.red,
    .item.line.red,
    .item.dot.red {
      background-color: #f0004c;
      border-color: #ce0041;
      color: white;
    }
    .item.box.quality-2 {
      font-size: 12pt;
    }
    .item.box.quality-3 {
      font-size: 18pt;
    }
  </style>
</head>

<body>

<h1>Wines</h1>

<div>
  <p>
    <label for="groupby">Group by:</label>
    <select id="groupby">
      <option value="quality">Quality</option>
      <option value="character">Character</option>
      <option value="age">Age</option>
    </select>
  </p>
</div>

<div id="timeline"></div>

<script type="text/javascript">
  // create a timeline
  var container = document.getElementById('timeline');
  var options = {
    height: '300px'
  };
  var items = new vis.DataSet();
  var groups = new vis.DataSet();
  var timeline = new vis.Timeline(container, items, options);
  timeline.setGroups(groups);

  var selection = document.getElementById('groupby');
  selection.onchange = applyData;
  function applyData () {
    var groupby = selection.value;

    var groupIds = {};

    var itemsArray = data.wines.map(function (wine) {
      var group = String(wine[groupby]);
      groupIds[group] = true;

      return {
        start: new Date(wine.year, 0, 1),
        className: wine.type + ' quality-' + wine.quality,
        content: wine.quality + ',' +
            wine.character + ',' +
            wine.age + '',
        group: group
      };
    });

    var groupsArray = Object.keys(groupIds).map(function (id) {
      return {
        id: id,
        content: id
      }
    });

    console.log(itemsArray)
    console.log(groupsArray)

    items.clear();
    items.add(itemsArray);

    groups.clear();
    groups.add(groupsArray);

    //timeline.setGroups(groupsArray.length ? groups: null);
  }

  applyData();

</script>

</body>
</html>
